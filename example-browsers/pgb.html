<!DOCTYPE html>

<html>

    <head>

        <style>
        </style>

        <title>Mouse GRCm38 :: Dalliance</title>
        <script language="javascript" src="../build/dalliance-all.js"></script>

        <script language="javascript" src="./pgb.js"></script>

        <script language="javascript">

         var gwasRenderer = WrappedRenderer.wrapRenderer(
             PS.gwasGlyphify, 300.0);

         var qtlRenderer = WrappedRenderer.wrapRenderer(
             PS.qtlGlyphify({ minScore: 4.0
                            , maxScore: 6.0
                            , color: "#ff0000"
             }),
             200.0);

         var cy;
         console.log(cy);
         window.onload = function() {
             // ugly hack - the bounding box for clicking in cy.js gets messed up
             // when the div is moved, which happens when BD loads
             window.setTimeout(function() {
                 cy = PS.cytoscape("cyHolder")(null);
                 var ff = PS.ajaxAddEles(cy)("http://localhost:8080/eles.json")();

                 PS.addCyFilter(b)(cy)();
                 PS.addBdScrollCallback(b)(cy)();

                 window.setTimeout(function() {
                     cy.layout({name: "circle"}).run();
                 }, 500);

             }, 2000);
         };


         var qtlSource = WrappedSource.wrapSource(PS.qtlFetch);

         var b = new Browser({
             chr:        '11',
             defaultStart: 10000000,
             defaultEnd: 30000000,
             viewStart:  10000000,
             viewEnd:    30000000,
             maxViewWidth: 20000000,
             cookieKey:  'mouse38',

             externalRenderers: { gwasRenderer: gwasRenderer,
                                  qtlRenderer: qtlRenderer
                                },

             coordSystem: {
                 speciesName: 'Mouse',
                 taxon: 10090,
                 auth: 'GRCm',
                 version: 38,
                 ucscName: 'mm10'
             },
             maxWorkers: 0,

             sources:      [{name: 'Genome',
                             twoBitURI:  'http://www.biodalliance.org/datasets/GRCm38/mm10.2bit',
                             desc: 'Mouse reference genome build GRCm38',
                             tier_type: 'sequence',
                             provides_entrypoints: true}
                           ,{name: 'GWAS',
                             renderer: "gwasRenderer",
                             "forceReduction": -1,
                             bwgURI: 'http://localhost:8080/gwascatalog.bb',
                           }
                           /*,{name: 'QTL',
                             tier_type: 'qtl',
                             renderer: "qtlRenderer",
                             uri: 'http://test-gn2.genenetwork.org/api_pre1/qtl/lod2.csv',
                             },*/
                           /*,{name: 'QTL 2',
                             tier_type: 'external',
                             external_fetch: PS.qtlFetch("http://test-gn2.genenetwork.org/api_pre1/qtl/lod2.csv"),
                             stylesheet: {},
                             renderer: "qtlRenderer",
                             },*/
                           ,
             ],
             uiPrefix: '../',

             fullScreen: true,

         });

         b.reset();
        </script>
    </head>

    <body>
        <style>
            #svgHolder {
                width: 100%,
                float: left;
            }
            #cyHolder {
                width: 100%;
                height: 300px;
                float: left;
                display: block;
            }
        </style>
        <div id='svgHolder'>Failed to load the Biodalliance genome browser.  Have you run "gulp"?</div>
        <div id="cyHolder" >Failed to load Cytoscape.</div>
    </body>
</html>
